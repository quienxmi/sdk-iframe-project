(function(n,s){typeof exports=="object"&&typeof module<"u"?module.exports=s():typeof define=="function"&&define.amd?define(s):(n=typeof globalThis<"u"?globalThis:n||self,n.QxmIframeProject=s())})(this,function(){"use strict";var b=Object.defineProperty;var g=(n,s,a)=>s in n?b(n,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[s]=a;var l=(n,s,a)=>g(n,typeof s!="symbol"?s+"":s,a);const n={SDK_CREATE:"The SDK could not be found.",IFRAME_NOT_FOUND:"The iframe could not be found.",DOM_NOT_IFRAME:"You cannot build the iframe because the DOM is not an iframe.",INVALID_TOKEN:"The token is expired or has an error. It is necessary to generate the token again.",INVALID_DOMAIN:"The source domain is not supported.",ERROR_LOADING_IFRAME:"The iframe could not be loaded correctly."},s=["localhost",".sandboxqxm.com",".quienpormi.com",".quienxmi.com",".qxm.com."];function a(c){try{const e=new URL(c),r=e.hostname;return s.some(t=>t==="localhost"?r==="localhost":e.protocol!=="https:"?!1:t.endsWith(".")?r.slice(0,-2).endsWith(t):r.endsWith(t))}catch{return!1}}const u=["iss","iat","exp","data"];function I(c){const e=Object.keys(c);return u.every(r=>e.includes(r))}function _(c){try{const r=c.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),t=JSON.parse(decodeURIComponent(atob(r).split("").map(function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join(""))),o=Math.floor(Date.now()/1e3);return t.exp>o&&I(t)?t:null}catch{return null}}const p="1.0.5",f={all:[],resize:[],modals:[],error:[]};class d{constructor(e,r){l(this,"_domIframe");l(this,"_observers",f);l(this,"_checkExp");l(this,"_logs",!1);try{const{scrolling:t,resize:o,logs:i}=r??{};if(typeof e=="string"?this._domIframe=document.querySelector(e):this._domIframe=e,i===!0&&(this._logs=!0),this._logs&&console.info("[QxmIframe]: Version "+p),!this._domIframe){this.errorLog("IFRAME_NOT_FOUND");return}if(!(this._domIframe instanceof HTMLIFrameElement)){this.errorLog("DOM_NOT_IFRAME");return}this._domIframe.setAttribute("frameborder","0"),t||this._domIframe.setAttribute("scrolling","no"),this.createListener(),(o??!0)&&this.subscribe("resize",this.resize)}catch(t){this.errorLog("SDK_CREATE",t)}}subscribe(e="all",r){this._observers[e].push(r)}error(e){this.subscribe("error",e)}modals(e){this.subscribe("modals",e)}async setToken(e){const r=_(e);return r?a(r.iss)?(this._checkExp=setInterval(()=>{const t=Math.floor(Date.now()/1e3);r.exp<t&&(this.errorLog("EXPIRED_TOKEN"),clearInterval(this._checkExp))},1e3),await this.setSrcIframe(r.iss,e)?r:null):(this.errorLog("INVALID_DOMAIN"),null):(this.errorLog("INVALID_TOKEN"),null)}destroy(){this._domIframe=void 0,this._observers=f}setSrcIframe(e,r){return new Promise(t=>{const o=this._domIframe,i=()=>{h(),t(!0)},m=()=>{this.errorLog("ERROR_LOADING_IFRAME"),h(),t(!1)},h=()=>{o.removeEventListener("load",i),o.removeEventListener("error",m)};try{o.src=e+"/api/iframe/project/create?token="+r,o.addEventListener("load",i),o.addEventListener("error",m)}catch{m()}})}createListener(){window.addEventListener("message",e=>{const{origin:r,data:t}=e;if(a(r)){this._logs&&console.log("[QxmIframe]:",t);let o=t.type??"all";this._observers[o]||(o="all"),this._observers[o].forEach(i=>i({_domIframe:this._domIframe,data:t}))}})}errorLog(e,r=null){const t=n[e]??e;this._logs&&console.error("[QxmIframe]:",t,r),this._observers.error.forEach(o=>o({_domIframe:this._domIframe,code:e,message:t,error:r}))}resize(e){const{_domIframe:r,data:t}=e,o=window.getComputedStyle(r),i=parseInt(o.paddingTop)+parseInt(o.paddingBottom);r.style.setProperty("height",`${t.height+i}px`,"important")}}return window.QxmIframeProject=d,d});
//# sourceMappingURL=qxm-iframe-project.umd.js.map
